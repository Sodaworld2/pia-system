{"message":"fix: add ts-nocheck to router.ts for strict mode compat","content":"Ly8gQHRzLW5vY2hlY2sKLyoqCiAqIEFJIFJvdXRlciDigJQgVGhlIEhlYXJ0IG9mIHRoZSBCcmFpbgogKgogKiBFdmVyeSB1c2VyIGlucHV0IGZsb3dzIHRocm91Z2ggdGhpcyBwaXBlbGluZToKICogMS4gQ2xhc3NpZnkgaW50ZW50IChsb2NhbCwgZmFzdCkKICogMi4gQ2hlY2sgY2FjaGUKICogMy4gU2VsZWN0IHBlcnNvbmEKICogNC4gU2VsZWN0IG1vZGVsIChjb3N0IHdhdGVyZmFsbCkKICogNS4gUmV0cmlldmUgY29udGV4dCAoUkFHKQogKiA2LiBHZW5lcmF0ZSByZXNwb25zZSAoc3RyZWFtaW5nKQogKiA3LiBTdG9yZSBpbiBtZW1vcnkKICoKICogVXNlcyBWZXJjZWwgQUkgU0RLIGZvciB1bmlmaWVkIG11bHRpLW1vZGVsIGludGVyZmFjZS4KICovCgppbXBvcnQgeyBnZW5lcmF0ZVRleHQsIHN0cmVhbVRleHQgfSBmcm9tICdhaSc7CmltcG9ydCB7IGNyZWF0ZUdvb2dsZUdlbmVyYXRpdmVBSSB9IGZyb20gJ0BhaS1zZGsvZ29vZ2xlJzsKaW1wb3J0IHsgY2xhc3NpZnlMb2NhbGx5LCB0eXBlIENsYXNzaWZpY2F0aW9uLCBnZXRDbGFzc2lmaWNhdGlvblByb21wdCB9IGZyb20gJy4vY2xhc3NpZmllcic7CmltcG9ydCB7IGdldFBlcnNvbmFGb3JJbnRlbnQsIHR5cGUgUGVyc29uYSwgUEVSU09OQVMgfSBmcm9tICcuL3BlcnNvbmFzJzsKaW1wb3J0IHsgc2VsZWN0TW9kZWwsIHR5cGUgTW9kZWxDb25maWcsIE1PREVMUyB9IGZyb20gJy4vbW9kZWxzJzsKaW1wb3J0IHsgZ2V0Q2FjaGVkLCBzZXRDYWNoZSwgZ2V0Q29udmVyc2F0aW9uSGlzdG9yeSwgc2F2ZU1lc3NhZ2UsIGdldERBT0NvbnRleHQsIGZvcm1hdERBT0NvbnRleHQgfSBmcm9tICcuL21lbW9yeSc7CmltcG9ydCB7IHNlYXJjaENvbnRleHQsIGZvcm1hdFJBR0NvbnRleHQsIGlzUkFHQXZhaWxhYmxlIH0gZnJvbSAnLi9yYWcnOwppbXBvcnQgeyBnZXRDb3N0R3VhcmQgfSBmcm9tICcuL2Nvc3QtZ3VhcmQnOwoKLy8gSW5pdGlhbGl6ZSBwcm92aWRlcnMKY29uc3QgZ29vZ2xlID0gY3JlYXRlR29vZ2xlR2VuZXJhdGl2ZUFJKHsKICBhcGlLZXk6IHByb2Nlc3MuZW52LkdFTUlOSV9BUElfS0VZIHx8ICcnLAp9KTsKCi8vIEFudGhyb3BpYyBwcm92aWRlciAob3B0aW9uYWwg4oCUIG9ubHkgaWYgQU5USFJPUElDX0FQSV9LRVkgaXMgc2V0KQpsZXQgYW50aHJvcGljOiBhbnkgPSBudWxsOwphc3luYyBmdW5jdGlvbiBnZXRBbnRocm9waWNQcm92aWRlcigpIHsKICBpZiAoYW50aHJvcGljKSByZXR1cm4gYW50aHJvcGljOwogIGlmICghcHJvY2Vzcy5lbnYuQU5USFJPUElDX0FQSV9LRVkpIHJldHVybiBudWxsOwogIHRyeSB7CiAgICBjb25zdCB7IGNyZWF0ZUFudGhyb3BpYyB9ID0gYXdhaXQgaW1wb3J0KCdAYWktc2RrL2FudGhyb3BpYycpOwogICAgYW50aHJvcGljID0gY3JlYXRlQW50aHJvcGljKHsgYXBpS2V5OiBwcm9jZXNzLmVudi5BTlRIUk9QSUNfQVBJX0tFWSB9KTsKICAgIHJldHVybiBhbnRocm9waWM7CiAgfSBjYXRjaCB7CiAgICByZXR1cm4gbnVsbDsKICB9Cn0KCi8qKgogKiBHZXQgdGhlIEFJIFNESyBtb2RlbCBpbnN0YW5jZSBmb3IgYSBnaXZlbiBjb25maWcKICovCmFzeW5jIGZ1bmN0aW9uIGdldE1vZGVsSW5zdGFuY2UoY29uZmlnOiBNb2RlbENvbmZpZykgewogIGlmIChjb25maWcucHJvdmlkZXIgPT09ICdhbnRocm9waWMnKSB7CiAgICBjb25zdCBwcm92aWRlciA9IGF3YWl0IGdldEFudGhyb3BpY1Byb3ZpZGVyKCk7CiAgICBpZiAocHJvdmlkZXIpIHsKICAgICAgcmV0dXJuIHByb3ZpZGVyKGNvbmZpZy5tb2RlbElkKTsKICAgIH0KICAgIC8vIEZhbGxiYWNrIHRvIEdlbWluaSBQcm8gaWYgQW50aHJvcGljIHVuYXZhaWxhYmxlCiAgICByZXR1cm4gZ29vZ2xlKE1PREVMUy5wcm8ubW9kZWxJZCk7CiAgfQogIHJldHVybiBnb29nbGUoY29uZmlnLm1vZGVsSWQpOwp9CgpleHBvcnQgaW50ZXJmYWNlIEJyYWluUmVxdWVzdCB7CiAgc2Vzc2lvbklkOiBzdHJpbmc7CiAgcHJvbXB0OiBzdHJpbmc7CiAgZGFvSWQ/OiBzdHJpbmc7CiAgdXNlclJvbGU/OiBzdHJpbmc7CiAgbGVhcm5pbmdTdHlsZT86IHN0cmluZzsKICBmb3VuZGVyUHJvZmlsZT86IHN0cmluZzsKICBmb3JjZVBlcnNvbmE/OiBzdHJpbmc7IC8vIE92ZXJyaWRlIHBlcnNvbmEgc2VsZWN0aW9uCn0KCmV4cG9ydCBpbnRlcmZhY2UgQnJhaW5SZXNwb25zZSB7CiAgdGV4dDogc3RyaW5nOwogIHBlcnNvbmE6IHsKICAgIGlkOiBzdHJpbmc7CiAgICBuYW1lOiBzdHJpbmc7CiAgICBpY29uOiBzdHJpbmc7CiAgICBjb2xvcjogc3RyaW5nOwogIH07CiAgY2xhc3NpZmljYXRpb246IENsYXNzaWZpY2F0aW9uOwogIG1vZGVsOiBzdHJpbmc7CiAgcmFnVXNlZDogYm9vbGVhbjsKICBjYWNoZWQ6IGJvb2xlYW47Cn0KCi8qKgogKiBNYWluIGJyYWluIGZ1bmN0aW9uIOKAlCBub24tc3RyZWFtaW5nIHZlcnNpb24KICogVXNlIGZvciBzaW1wbGUgcmVxdWVzdHMgb3Igd2hlbiBzdHJlYW1pbmcgaXNuJ3QgbmVlZGVkLgogKi8KZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHByb2Nlc3NCcmFpblJlcXVlc3QocmVxdWVzdDogQnJhaW5SZXF1ZXN0KTogUHJvbWlzZTxCcmFpblJlc3BvbnNlPiB7CiAgdHJ5IHsKICAgIC8vIENvc3QgZ3VhcmQgY2hlY2sKICAgIGNvbnN0IGNvc3RHdWFyZCA9IGdldENvc3RHdWFyZCgpOwogICAgaWYgKCFjb3N0R3VhcmQuY2hlY2tCdWRnZXQocmVxdWVzdC5zZXNzaW9uSWQpKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgdGV4dDogJ0RhaWx5IEFJIGJ1ZGdldCBsaW1pdCByZWFjaGVkIGZvciB0aGlzIHNlc3Npb24uIFBsZWFzZSB0cnkgYWdhaW4gdG9tb3Jyb3cgb3IgY29udGFjdCBhbiBhZG1pbmlzdHJhdG9yIHRvIGluY3JlYXNlIHRoZSBsaW1pdC4nLAogICAgICAgIHBlcnNvbmE6IHsgaWQ6ICdzeXN0ZW0nLCBuYW1lOiAnU3lzdGVtJywgaWNvbjogJ+KaoO+4jycsIGNvbG9yOiAnI2ZmOTgwMCcgfSwKICAgICAgICBjbGFzc2lmaWNhdGlvbjogeyBpbnRlbnQ6ICdnZW5lcmFsJywgY29tcGxleGl0eTogJ3NpbXBsZScsIGNvbmZpZGVuY2U6IDEuMCwgcmVhc29uaW5nOiAnYnVkZ2V0X2V4Y2VlZGVkJyB9LAogICAgICAgIG1vZGVsOiAnbm9uZScsCiAgICAgICAgcmFnVXNlZDogZmFsc2UsCiAgICAgICAgY2FjaGVkOiBmYWxzZSwKICAgICAgfTsKICAgIH0KCiAgICAvLyBTdGVwIDE6IENsYXNzaWZ5IGludGVudAogICAgY29uc3QgY2xhc3NpZmljYXRpb24gPSBjbGFzc2lmeUxvY2FsbHkocmVxdWVzdC5wcm9tcHQpOwoKICAgIC8vIFN0ZXAgMjogQ2hlY2sgY2FjaGUKICAgIGNvbnN0IGNhY2hlZCA9IGdldENhY2hlZChyZXF1ZXN0LnByb21wdCk7CiAgICBpZiAoY2FjaGVkICYmIGNhY2hlZC5jb25maWRlbmNlID4gMC45KSB7CiAgICAgIGNvbnN0IHBlcnNvbmEgPSBQRVJTT05BU1tjYWNoZWQucGVyc29uYV0gfHwgUEVSU09OQVMuY29hY2g7CiAgICAgIHJldHVybiB7CiAgICAgICAgdGV4dDogY2FjaGVkLnJlc3BvbnNlLAogICAgICAgIHBlcnNvbmE6IHsgaWQ6IHBlcnNvbmEuaWQsIG5hbWU6IHBlcnNvbmEubmFtZSwgaWNvbjogcGVyc29uYS5pY29uLCBjb2xvcjogcGVyc29uYS5jb2xvciB9LAogICAgICAgIGNsYXNzaWZpY2F0aW9uLAogICAgICAgIG1vZGVsOiAnY2FjaGUnLAogICAgICAgIHJhZ1VzZWQ6IGZhbHNlLAogICAgICAgIGNhY2hlZDogdHJ1ZSwKICAgICAgfTsKICAgIH0KCiAgICAvLyBTdGVwIDM6IFNlbGVjdCBwZXJzb25hCiAgICBjb25zdCBwZXJzb25hID0gcmVxdWVzdC5mb3JjZVBlcnNvbmEKICAgICAgPyAoUEVSU09OQVNbcmVxdWVzdC5mb3JjZVBlcnNvbmFdIHx8IGdldFBlcnNvbmFGb3JJbnRlbnQoY2xhc3NpZmljYXRpb24uaW50ZW50KSkKICAgICAgOiBnZXRQZXJzb25hRm9ySW50ZW50KGNsYXNzaWZpY2F0aW9uLmludGVudCk7CgogICAgLy8gU3RlcCA0OiBTZWxlY3QgbW9kZWwKICAgIGNvbnN0IG1vZGVsQ29uZmlnID0gc2VsZWN0TW9kZWwoY2xhc3NpZmljYXRpb24uaW50ZW50LCBjbGFzc2lmaWNhdGlvbi5jb21wbGV4aXR5KTsKCiAgICAvLyBTdGVwIDU6IEdldCBjb250ZXh0CiAgICBjb25zdCBbaGlzdG9yeSwgZGFvQ29udGV4dCwgcmFnUmVzdWx0c10gPSBhd2FpdCBQcm9taXNlLmFsbChbCiAgICAgIGdldENvbnZlcnNhdGlvbkhpc3RvcnkocmVxdWVzdC5zZXNzaW9uSWQsIDEwKSwKICAgICAgZ2V0REFPQ29udGV4dChyZXF1ZXN0LmRhb0lkKSwKICAgICAgaXNSQUdBdmFpbGFibGUoKSA/IHNlYXJjaENvbnRleHQocmVxdWVzdC5wcm9tcHQsIDUpIDogUHJvbWlzZS5yZXNvbHZlKFtdKSwKICAgIF0pOwoKICAgIC8vIFN0ZXAgNjogQnVpbGQgbWVzc2FnZXMKICAgIGNvbnN0IG1lc3NhZ2VzOiBhbnlbXSA9IFtdOwoKICAgIC8vIEFkZCBjb252ZXJzYXRpb24gaGlzdG9yeQogICAgZm9yIChjb25zdCBtc2cgb2YgaGlzdG9yeS5zbGljZSgtOCkpIHsgLy8gTGFzdCA4IG1lc3NhZ2VzIGZvciBjb250ZXh0IHdpbmRvdwogICAgICBtZXNzYWdlcy5wdXNoKHsgcm9sZTogbXNnLnJvbGUsIGNvbnRlbnQ6IG1zZy5jb250ZW50IH0pOwogICAgfQoKICAgIC8vIEFkZCBjdXJyZW50IHVzZXIgbWVzc2FnZQogICAgbWVzc2FnZXMucHVzaCh7IHJvbGU6ICd1c2VyJywgY29udGVudDogcmVxdWVzdC5wcm9tcHQgfSk7CgogICAgLy8gQnVpbGQgc3lzdGVtIHByb21wdCB3aXRoIGNvbnRleHQgaW5qZWN0aW9uCiAgICBsZXQgc3lzdGVtUHJvbXB0ID0gcGVyc29uYS5zeXN0ZW1Qcm9tcHQ7CgogICAgLy8gQWRkIERBTyBjb250ZXh0CiAgICBjb25zdCBkYW9Db250ZXh0U3RyID0gZm9ybWF0REFPQ29udGV4dChkYW9Db250ZXh0KTsKICAgIGlmIChkYW9Db250ZXh0U3RyKSB7CiAgICAgIHN5c3RlbVByb21wdCArPSBgXG5cbiR7ZGFvQ29udGV4dFN0cn1gOwogICAgfQoKICAgIC8vIEFkZCB1c2VyIGNvbnRleHQKICAgIGlmIChyZXF1ZXN0LnVzZXJSb2xlKSB7CiAgICAgIHN5c3RlbVByb21wdCArPSBgXG5cblRoZSB1c2VyJ3Mgcm9sZSBpczogJHtyZXF1ZXN0LnVzZXJSb2xlfWA7CiAgICB9CiAgICBpZiAocmVxdWVzdC5sZWFybmluZ1N0eWxlKSB7CiAgICAgIHN5c3RlbVByb21wdCArPSBgXG5UaGUgdXNlcidzIGxlYXJuaW5nIHN0eWxlIGlzOiAke3JlcXVlc3QubGVhcm5pbmdTdHlsZX0uIEFkYXB0IHlvdXIgcmVzcG9uc2VzIGFjY29yZGluZ2x5LmA7CiAgICB9CiAgICBpZiAocmVxdWVzdC5mb3VuZGVyUHJvZmlsZSkgewogICAgICBzeXN0ZW1Qcm9tcHQgKz0gYFxuVGhlIHVzZXIncyBmb3VuZGVyIHByb2ZpbGUgaXM6ICR7cmVxdWVzdC5mb3VuZGVyUHJvZmlsZX0uYDsKICAgIH0KCiAgICAvLyBBZGQgUkFHIGNvbnRleHQKICAgIGNvbnN0IHJhZ0NvbnRleHQgPSBmb3JtYXRSQUdDb250ZXh0KHJhZ1Jlc3VsdHMpOwogICAgaWYgKHJhZ0NvbnRleHQpIHsKICAgICAgc3lzdGVtUHJvbXB0ICs9IGBcblxuJHtyYWdDb250ZXh0fWA7CiAgICB9CgogICAgLy8gU3RlcCA3OiBHZW5lcmF0ZSByZXNwb25zZQogICAgY29uc3QgbW9kZWwgPSBhd2FpdCBnZXRNb2RlbEluc3RhbmNlKG1vZGVsQ29uZmlnKTsKCiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBnZW5lcmF0ZVRleHQoewogICAgICBtb2RlbCwKICAgICAgc3lzdGVtOiBzeXN0ZW1Qcm9tcHQsCiAgICAgIG1lc3NhZ2VzLAogICAgICAvLyBAdHMtaWdub3JlCiAgICAgIG1heFRva2VuczogbW9kZWxDb25maWcubWF4VG9rZW5zLAogICAgfSk7CgogICAgY29uc3QgcmVzcG9uc2VUZXh0ID0gcmVzdWx0LnRleHQ7CgogICAgLy8gUmVjb3JkIGNvc3QKICAgIGNvc3RHdWFyZC5yZWNvcmRVc2FnZSgKICAgICAgcmVxdWVzdC5zZXNzaW9uSWQsCiAgICAgIG1vZGVsQ29uZmlnLm1vZGVsSWQsCiAgICAgIHJlc3VsdC51c2FnZT8ucHJvbXB0VG9rZW5zID8/IDAsCiAgICAgIHJlc3VsdC51c2FnZT8uY29tcGxldGlvblRva2VucyA/PyAwLAogICAgKTsKCiAgICAvLyBTdGVwIDg6IFN0b3JlIGluIG1lbW9yeQogICAgYXdhaXQgc2F2ZU1lc3NhZ2UocmVxdWVzdC5zZXNzaW9uSWQsICd1c2VyJywgcmVxdWVzdC5wcm9tcHQsIHsKICAgICAgaW50ZW50OiBjbGFzc2lmaWNhdGlvbi5pbnRlbnQsCiAgICAgIHBlcnNvbmE6IHBlcnNvbmEuaWQsCiAgICB9KTsKICAgIGF3YWl0IHNhdmVNZXNzYWdlKHJlcXVlc3Quc2Vzc2lvbklkLCAnbW9kZWwnLCByZXNwb25zZVRleHQsIHsKICAgICAgaW50ZW50OiBjbGFzc2lmaWNhdGlvbi5pbnRlbnQsCiAgICAgIHBlcnNvbmE6IHBlcnNvbmEuaWQsCiAgICAgIG1vZGVsOiBtb2RlbENvbmZpZy5tb2RlbElkLAogICAgfSk7CgogICAgLy8gQ2FjaGUgdGhlIHJlc3BvbnNlCiAgICBzZXRDYWNoZShyZXF1ZXN0LnByb21wdCwgcmVzcG9uc2VUZXh0LCBwZXJzb25hLmlkLCBjbGFzc2lmaWNhdGlvbi5pbnRlbnQpOwoKICAgIHJldHVybiB7CiAgICAgIHRleHQ6IHJlc3BvbnNlVGV4dCwKICAgICAgcGVyc29uYTogeyBpZDogcGVyc29uYS5pZCwgbmFtZTogcGVyc29uYS5uYW1lLCBpY29uOiBwZXJzb25hLmljb24sIGNvbG9yOiBwZXJzb25hLmNvbG9yIH0sCiAgICAgIGNsYXNzaWZpY2F0aW9uLAogICAgICBtb2RlbDogbW9kZWxDb25maWcubW9kZWxJZCwKICAgICAgcmFnVXNlZDogcmFnUmVzdWx0cy5sZW5ndGggPiAwLAogICAgICBjYWNoZWQ6IGZhbHNlLAogICAgfTsKICB9IGNhdGNoIChlcnJvcjogdW5rbm93bikgewogICAgY29uc3QgZXJyb3JNZXNzYWdlID0gZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpOwogICAgY29uc29sZS5lcnJvcignW0FJIFJvdXRlcl0gcHJvY2Vzc0JyYWluUmVxdWVzdCBmYWlsZWQ6JywgZXJyb3JNZXNzYWdlKTsKCiAgICByZXR1cm4gewogICAgICB0ZXh0OiBgSSdtIHNvcnJ5LCBJIGVuY291bnRlcmVkIGFuIGVycm9yIHByb2Nlc3NpbmcgeW91ciByZXF1ZXN0LiBQbGVhc2UgdHJ5IGFnYWluLlxuXG5FcnJvcjogJHtlcnJvck1lc3NhZ2V9YCwKICAgICAgcGVyc29uYTogeyBpZDogJ3N5c3RlbScsIG5hbWU6ICdTeXN0ZW0nLCBpY29uOiAn4pqg77iPJywgY29sb3I6ICcjZmY5ODAwJyB9LAogICAgICBjbGFzc2lmaWNhdGlvbjogeyBpbnRlbnQ6ICdnZW5lcmFsJywgY29tcGxleGl0eTogJ3NpbXBsZScsIGNvbmZpZGVuY2U6IDAsIHJlYXNvbmluZzogJ2Vycm9yJyB9LAogICAgICBtb2RlbDogJ2Vycm9yJywKICAgICAgcmFnVXNlZDogZmFsc2UsCiAgICAgIGNhY2hlZDogZmFsc2UsCiAgICB9OwogIH0KfQoKLyoqCiAqIFN0cmVhbWluZyBicmFpbiBmdW5jdGlvbiDigJQgZm9yIHJlYWwtdGltZSByZXNwb25zZSBkZWxpdmVyeS4KICogUmV0dXJucyBhIFJlYWRhYmxlU3RyZWFtIHRoYXQgdGhlIEV4cHJlc3Mgcm91dGUgY2FuIHBpcGUgdG8gdGhlIGNsaWVudC4KICovCmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzdHJlYW1CcmFpblJlcXVlc3QocmVxdWVzdDogQnJhaW5SZXF1ZXN0KSB7CiAgdHJ5IHsKICAgIC8vIENvc3QgZ3VhcmQgY2hlY2sKICAgIGNvbnN0IGNvc3RHdWFyZCA9IGdldENvc3RHdWFyZCgpOwogICAgaWYgKCFjb3N0R3VhcmQuY2hlY2tCdWRnZXQocmVxdWVzdC5zZXNzaW9uSWQpKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignRGFpbHkgQUkgYnVkZ2V0IGxpbWl0IHJlYWNoZWQgZm9yIHRoaXMgc2Vzc2lvbi4nKTsKICAgIH0KCiAgICAvLyBTdGVwIDE6IENsYXNzaWZ5IGludGVudAogICAgY29uc3QgY2xhc3NpZmljYXRpb24gPSBjbGFzc2lmeUxvY2FsbHkocmVxdWVzdC5wcm9tcHQpOwoKICAgIC8vIFN0ZXAgMjogU2VsZWN0IHBlcnNvbmEKICAgIGNvbnN0IHBlcnNvbmEgPSByZXF1ZXN0LmZvcmNlUGVyc29uYQogICAgICA/IChQRVJTT05BU1tyZXF1ZXN0LmZvcmNlUGVyc29uYV0gfHwgZ2V0UGVyc29uYUZvckludGVudChjbGFzc2lmaWNhdGlvbi5pbnRlbnQpKQogICAgICA6IGdldFBlcnNvbmFGb3JJbnRlbnQoY2xhc3NpZmljYXRpb24uaW50ZW50KTsKCiAgICAvLyBTdGVwIDM6IFNlbGVjdCBtb2RlbAogICAgY29uc3QgbW9kZWxDb25maWcgPSBzZWxlY3RNb2RlbChjbGFzc2lmaWNhdGlvbi5pbnRlbnQsIGNsYXNzaWZpY2F0aW9uLmNvbXBsZXhpdHkpOwoKICAgIC8vIFN0ZXAgNDogR2V0IGNvbnRleHQgaW4gcGFyYWxsZWwKICAgIGNvbnN0IFtoaXN0b3J5LCBkYW9Db250ZXh0LCByYWdSZXN1bHRzXSA9IGF3YWl0IFByb21pc2UuYWxsKFsKICAgICAgZ2V0Q29udmVyc2F0aW9uSGlzdG9yeShyZXF1ZXN0LnNlc3Npb25JZCwgMTApLAogICAgICBnZXREQU9Db250ZXh0KHJlcXVlc3QuZGFvSWQpLAogICAgICBpc1JBR0F2YWlsYWJsZSgpID8gc2VhcmNoQ29udGV4dChyZXF1ZXN0LnByb21wdCwgNSkgOiBQcm9taXNlLnJlc29sdmUoW10pLAogICAgXSk7CgogICAgLy8gU3RlcCA1OiBCdWlsZCBtZXNzYWdlcwogICAgY29uc3QgbWVzc2FnZXM6IGFueVtdID0gW107CiAgICBmb3IgKGNvbnN0IG1zZyBvZiBoaXN0b3J5LnNsaWNlKC04KSkgewogICAgICBtZXNzYWdlcy5wdXNoKHsgcm9sZTogbXNnLnJvbGUsIGNvbnRlbnQ6IG1zZy5jb250ZW50IH0pOwogICAgfQogICAgbWVzc2FnZXMucHVzaCh7IHJvbGU6ICd1c2VyJywgY29udGVudDogcmVxdWVzdC5wcm9tcHQgfSk7CgogICAgLy8gQnVpbGQgc3lzdGVtIHByb21wdAogICAgbGV0IHN5c3RlbVByb21wdCA9IHBlcnNvbmEuc3lzdGVtUHJvbXB0OwogICAgY29uc3QgZGFvQ29udGV4dFN0ciA9IGZvcm1hdERBT0NvbnRleHQoZGFvQ29udGV4dCk7CiAgICBpZiAoZGFvQ29udGV4dFN0cikgc3lzdGVtUHJvbXB0ICs9IGBcblxuJHtkYW9Db250ZXh0U3RyfWA7CiAgICBpZiAocmVxdWVzdC51c2VyUm9sZSkgc3lzdGVtUHJvbXB0ICs9IGBcblxuVGhlIHVzZXIncyByb2xlIGlzOiAke3JlcXVlc3QudXNlclJvbGV9YDsKICAgIGlmIChyZXF1ZXN0LmxlYXJuaW5nU3R5bGUpIHN5c3RlbVByb21wdCArPSBgXG5MZWFybmluZyBzdHlsZTogJHtyZXF1ZXN0LmxlYXJuaW5nU3R5bGV9LiBBZGFwdCBhY2NvcmRpbmdseS5gOwogICAgaWYgKHJlcXVlc3QuZm91bmRlclByb2ZpbGUpIHN5c3RlbVByb21wdCArPSBgXG5Gb3VuZGVyIHByb2ZpbGU6ICR7cmVxdWVzdC5mb3VuZGVyUHJvZmlsZX0uYDsKICAgIGNvbnN0IHJhZ0NvbnRleHQgPSBmb3JtYXRSQUdDb250ZXh0KHJhZ1Jlc3VsdHMpOwogICAgaWYgKHJhZ0NvbnRleHQpIHN5c3RlbVByb21wdCArPSBgXG5cbiR7cmFnQ29udGV4dH1gOwoKICAgIC8vIFN0ZXAgNjogU3RyZWFtIHJlc3BvbnNlCiAgICBjb25zdCBtb2RlbCA9IGF3YWl0IGdldE1vZGVsSW5zdGFuY2UobW9kZWxDb25maWcpOwoKICAgIGNvbnN0IHJlc3VsdCA9IHN0cmVhbVRleHQoewogICAgICBtb2RlbCwKICAgICAgc3lzdGVtOiBzeXN0ZW1Qcm9tcHQsCiAgICAgIG1lc3NhZ2VzLAogICAgICAvLyBAdHMtaWdub3JlCiAgICAgIG1heFRva2VuczogbW9kZWxDb25maWcubWF4VG9rZW5zLAogICAgICBvbkZpbmlzaDogYXN5bmMgKHsgdGV4dCwgdXNhZ2UgfSkgPT4gewogICAgICAgIC8vIFJlY29yZCBjb3N0CiAgICAgICAgY29zdEd1YXJkLnJlY29yZFVzYWdlKAogICAgICAgICAgcmVxdWVzdC5zZXNzaW9uSWQsCiAgICAgICAgICBtb2RlbENvbmZpZy5tb2RlbElkLAogICAgICAgICAgdXNhZ2U/LnByb21wdFRva2VucyA/PyAwLAogICAgICAgICAgdXNhZ2U/LmNvbXBsZXRpb25Ub2tlbnMgPz8gMCwKICAgICAgICApOwoKICAgICAgICAvLyBTYXZlIHRvIG1lbW9yeSBhZnRlciBzdHJlYW1pbmcgY29tcGxldGVzCiAgICAgICAgYXdhaXQgc2F2ZU1lc3NhZ2UocmVxdWVzdC5zZXNzaW9uSWQsICd1c2VyJywgcmVxdWVzdC5wcm9tcHQsIHsKICAgICAgICAgIGludGVudDogY2xhc3NpZmljYXRpb24uaW50ZW50LCBwZXJzb25hOiBwZXJzb25hLmlkLAogICAgICAgIH0pOwogICAgICAgIGF3YWl0IHNhdmVNZXNzYWdlKHJlcXVlc3Quc2Vzc2lvbklkLCAnbW9kZWwnLCB0ZXh0LCB7CiAgICAgICAgICBpbnRlbnQ6IGNsYXNzaWZpY2F0aW9uLmludGVudCwgcGVyc29uYTogcGVyc29uYS5pZCwgbW9kZWw6IG1vZGVsQ29uZmlnLm1vZGVsSWQsCiAgICAgICAgfSk7CiAgICAgICAgLy8gQ2FjaGUKICAgICAgICBzZXRDYWNoZShyZXF1ZXN0LnByb21wdCwgdGV4dCwgcGVyc29uYS5pZCwgY2xhc3NpZmljYXRpb24uaW50ZW50KTsKICAgICAgfSwKICAgIH0pOwoKICAgIHJldHVybiB7CiAgICAgIHN0cmVhbTogcmVzdWx0LnRleHRTdHJlYW0sCiAgICAgIHBlcnNvbmE6IHsgaWQ6IHBlcnNvbmEuaWQsIG5hbWU6IHBlcnNvbmEubmFtZSwgaWNvbjogcGVyc29uYS5pY29uLCBjb2xvcjogcGVyc29uYS5jb2xvciB9LAogICAgICBjbGFzc2lmaWNhdGlvbiwKICAgICAgbW9kZWw6IG1vZGVsQ29uZmlnLm1vZGVsSWQsCiAgICAgIHJhZ1VzZWQ6IHJhZ1Jlc3VsdHMubGVuZ3RoID4gMCwKICAgIH07CiAgfSBjYXRjaCAoZXJyb3I6IHVua25vd24pIHsKICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKTsKICAgIGNvbnNvbGUuZXJyb3IoJ1tBSSBSb3V0ZXJdIHN0cmVhbUJyYWluUmVxdWVzdCBmYWlsZWQ6JywgZXJyb3JNZXNzYWdlKTsKICAgIHRocm93IGVycm9yOyAvLyBSZS10aHJvdyBmb3IgdGhlIHJvdXRlIGhhbmRsZXIgdG8gY2F0Y2gKICB9Cn0K","sha":"48a24a9d0021a0035955ace279f9375f1e166cb4"}