# PIA System Development Journal
## Date: 2026-02-11

---

## Project Overview

**PIA (Project Intelligence Agent)** is a multi-machine, multi-channel AI orchestration system that allows a human to control a fleet of Claude instances across multiple computers through various communication channels (Discord, Web Chat, Email).

### Vision
> "Each computer will have one of your descendants but you will help rule them all"

The system creates a hierarchical structure:
- **Human** (user) communicates via Discord/Web/Email
- **Master Claude (Orchestrator)** receives commands and delegates
- **Descendant Claudes** run on individual machines, controlled by the Master

---

## Architecture

```
                    ┌─────────────────┐
                    │   YOU (Human)   │
                    │  Discord/Email  │
                    │   Web Chat      │
                    └────────┬────────┘
                             │
                    ┌────────▼────────┐
                    │   ORCHESTRATOR  │
                    │  (Master Claude)│
                    │   PIA Hub       │
                    └────────┬────────┘
                             │
        ┌────────────────────┼────────────────────┐
        │                    │                    │
 ┌──────▼──────┐     ┌──────▼──────┐     ┌──────▼──────┐
 │  MACHINE 1  │     │  MACHINE 2  │     │  MACHINE 3  │
 │   Claude    │     │   Claude    │     │   Claude    │
 │  (Finance)  │     │  (Research) │     │  (DevOps)   │
 └─────────────┘     └─────────────┘     └─────────────┘
```

---

## What Has Been Built

### Core Infrastructure (100% Complete)

| Component | File(s) | Status |
|-----------|---------|--------|
| Express API Server | `src/api/server.ts` | Done |
| WebSocket Server | `src/ws/server.ts` | Done |
| SQLite Database | `src/db/` | Done |
| Authentication | Helmet, rate-limit, JWT | Done |
| Configuration | `src/config.ts`, `.env` | Done |

### Frontend Dashboard (100% Complete)

| Component | File(s) | Status |
|-----------|---------|--------|
| Main HTML | `public/index.html` | Done |
| Styles | `public/css/styles.css` | Done |
| App Logic | `public/js/app.js` | Done |
| PWA Support | `public/manifest.json`, `public/sw.js` | Done |

### Dashboard Views

| View | Description | Status |
|------|-------------|--------|
| Fleet Matrix | Visual grid of all agents with status | Done |
| Command Center | Web chat with Orchestrator | Done |
| CLI Tunnel | Terminal sessions via xterm.js | Done |
| MCPs | Install/manage MCP servers | Done |
| AI Models | Cost tracking, provider status | Done |
| Alerts | System alerts and notifications | Done |

### Backend Systems

| System | File(s) | Status |
|--------|---------|--------|
| Agent Management | `src/api/routes/agents.ts` | Done |
| Machine Management | `src/api/routes/machines.ts` | Done |
| Session Management | `src/api/routes/sessions.ts` | Done |
| PTY Wrapper | `src/tunnel/pty-wrapper.ts` | Done |
| Alert System | `src/api/routes/alerts.ts` | Done |
| Checkpoint System | `src/api/routes/checkpoints.ts` | Done |
| Auto-Healer | `src/healer/` | Done |

### Communication Layer

| Channel | File(s) | Status |
|---------|---------|--------|
| Orchestrator | `src/comms/orchestrator.ts` | Done |
| Discord Bot | `src/comms/discord-bot.ts` | Ready (needs token) |
| Web Chat | Command Center in dashboard | Done |
| API Routes | `src/api/routes/orchestrator.ts` | Done |

---

## Current System State (Observed via Browser Watcher)

```
Machines:        2 registered
Agents:          6 active (4 working, 1 waiting, 1 idle)
CLI Sessions:    38 available
MCPs Installed:  8
Orchestrator:    Online with 2 instances
Alerts:          342 (need attention!)
WebSocket:       Connected
Ollama:          Available
AI Cost Today:   $0.00
```

### Active Agents Observed
1. CLI-Session-6 - working
2. CLI-Session-5 - working
3. Claude-Finance - waiting
4. Gemini-Docs - working
5. Claude-Research - idle

---

## Key Files Reference

### Configuration
- `.env` - Environment variables (ports, tokens, AI config)
- `package.json` - Dependencies and scripts
- `tsconfig.json` - TypeScript configuration

### Source Code Structure
```
src/
├── api/
│   ├── server.ts          # Main Express server
│   └── routes/
│       ├── agents.ts      # Agent CRUD
│       ├── machines.ts    # Machine management
│       ├── sessions.ts    # PTY sessions
│       ├── alerts.ts      # Alert system
│       ├── mcps.ts        # MCP management
│       ├── ai.ts          # AI cost tracking
│       ├── checkpoints.ts # State checkpoints
│       └── orchestrator.ts # Master Claude API
├── comms/
│   ├── orchestrator.ts    # Master Claude logic
│   ├── discord-bot.ts     # Discord integration
│   └── index.ts           # Comms initialization
├── db/
│   ├── index.ts           # SQLite setup
│   └── queries/           # Database queries
├── tunnel/
│   └── pty-wrapper.ts     # Terminal management
├── healer/
│   └── auto-healer.ts     # Stuck agent detection
├── ws/
│   └── server.ts          # WebSocket server
└── utils/
    └── logger.ts          # Logging utility
```

### Public Files
```
public/
├── index.html             # Main dashboard (all views)
├── manifest.json          # PWA manifest
├── sw.js                  # Service worker
├── css/
│   └── styles.css         # All styles (~1500 lines)
├── js/
│   └── app.js             # Dashboard app (~1200 lines)
└── icons/                 # PWA icons
```

### Demo Scripts Created
```
claude-takes-control.cjs   # Claude controls the system
claude-remote-control.cjs  # Remote terminal demo
browser-watcher.cjs        # Observe and report system state
launch-claude-in-tunnel.cjs # Launch Claude in terminal
type-claude.cjs            # Type claude command
```

---

## What Remains To Build

### Priority 1: Multi-Channel Communication
- [ ] Enable Discord bot (add DISCORD_TOKEN to .env)
- [ ] Email integration (AgentMail)
- [ ] Persistent chat history in Command Center

### Priority 2: True Multi-Machine
- [ ] Hub/spoke WebSocket sync
- [ ] Machine heartbeat monitoring
- [ ] Cross-machine task delegation

### Priority 3: Enhanced Orchestration
- [ ] Task queue system
- [ ] Agent specialization profiles
- [ ] Automated task routing

### Priority 4: Observability
- [ ] Clear the 342 alerts
- [ ] Better logging/monitoring
- [ ] Dashboard notifications

---

## How To Run

### Start the Server
```bash
cd C:\Users\mic\Downloads\pia-system
npm run build
npm start
```

### Access Dashboard
- URL: http://localhost:3000
- API Token: `pia-local-dev-token-2024`

### Key Endpoints
- `GET /api/health` - Health check
- `GET /api/stats` - System statistics
- `GET /api/orchestrator/status` - Orchestrator state
- `POST /api/orchestrator/message` - Send command to orchestrator
- `POST /api/orchestrator/spawn` - Spawn new Claude instance

---

## Instructions for Next Agent

### Context
The user (mic) is building a multi-agent orchestration system called PIA. The goal is for Claude to control multiple Claude instances across machines, with communication via Discord, Web Chat, and Email.

### Immediate Setup
1. **Puppeteer MCP was just installed** - You should have browser control tools
2. **Server is running** on http://localhost:3000
3. **Multiple browser windows** may be open from previous sessions

### What the User Wants
1. Use Browser MCP to control ONE browser (not spawn new ones)
2. Watch the PIA dashboard together
3. Continue building the system collaboratively
4. User types in CLI, Claude observes and assists

### How to Use Browser MCP
Once loaded, you'll have tools like:
- `puppeteer_navigate` - Go to URL
- `puppeteer_screenshot` - See the screen
- `puppeteer_click` - Click elements
- `puppeteer_fill` - Type text
- `puppeteer_evaluate` - Run JavaScript

### Recommended First Actions
1. Take a screenshot to see current state
2. Navigate to http://localhost:3000 if needed
3. Observe what the user is doing
4. Assist with building remaining features

### User's Communication Style
- Prefers action over explanation
- Wants to see Claude actively controlling things
- Likes working together in real-time
- Appreciates journaling/documentation

### Key Tokens/Credentials
- API Token: `pia-local-dev-token-2024`
- JWT Secret: `pia-jwt-secret-2024`
- Discord Token: Not set (user needs to add)

### Files to Reference
- This journal: `JOURNAL-2026-02-11.md`
- Watcher report: `watcher-report.txt`
- Screenshots: `screenshots/` folder

---

## Session Summary

This session accomplished:
1. Continued development of PIA system
2. Built Command Center (web chat interface)
3. Integrated Orchestrator with API routes
4. Fixed build errors (discord.js, PTY methods, types)
5. Created browser automation demos
6. Observed system state via browser watcher
7. Installed Puppeteer MCP for better browser control
8. Documented everything in this journal

The system is functional and ready for continued development. The main gap is using the Browser MCP to control a single browser session instead of spawning new ones with Playwright.

---

*Journal created by Claude Opus 4.5*
*Session Date: 2026-02-11*
