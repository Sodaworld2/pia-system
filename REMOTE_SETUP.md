# PIA Remote Machine Setup Guide

**Copy this file to the other computer and follow these steps.**

---

## What This Does

Connects your other computer (e.g. the DAO machine) to PIA hub on this machine.
Once connected, both machines can send messages, commands, tasks, and status updates to each other in real-time.

---

## Quick Start (2 minutes)

### Step 1: Install Tailscale (if not already)

Download from: https://tailscale.com/download

Login with the **same account** as the hub machine (mic@).

After connecting, you should see the hub machine:
```
tailscale status
# Should show: 100.73.133.3   izzit7   mic@   windows
```

### Step 2: Test Connection

```bash
# Can you reach the PIA hub?
curl -H "X-Api-Token: pia-local-dev-token-2024" http://100.73.133.3:3000/api/health
```

Expected response:
```json
{"status":"ok","mode":"hub","timestamp":"..."}
```

### Step 3: Copy the Connector Script

Copy `scripts/remote-connect.cjs` to the other machine.

Or just download it:
```bash
curl -H "X-Api-Token: pia-local-dev-token-2024" http://100.73.133.3:3000/api/health
# If that works, you can copy the script manually or via shared folder
```

### Step 4: Install ws package (for WebSocket mode)

```bash
npm install ws
```

### Step 5: Connect!

**Via Tailscale (recommended):**
```bash
node remote-connect.cjs --hub http://100.73.133.3:3000 --name "DAO-Machine" --project "DAO"
```

**Via Ngrok (if Tailscale isn't available):**
```bash
# On the HUB machine, run: scripts\start-tunnel.cmd
# It will show a public URL like https://abc123.ngrok-free.app
# Then on the remote machine:
node remote-connect.cjs --hub https://abc123.ngrok-free.app --name "DAO-Machine" --project "DAO"
```

**Via HTTP polling (no ws needed):**
```bash
node remote-connect.cjs --hub http://100.73.133.3:3000 --name "DAO-Machine" --project "DAO" --poll
```

---

## Connection Methods

| Method | Speed | Setup | Best For |
|--------|-------|-------|----------|
| **Tailscale** | Fast (direct) | Install Tailscale, login | Always-on connection |
| **Ngrok** | Medium (tunneled) | Run start-tunnel.cmd on hub | Quick testing, behind firewalls |
| **HTTP Polling** | Slow (3s delay) | Nothing extra needed | Minimal setup, no WebSocket |

---

## Interactive Commands

Once connected, you can type:

| Command | Description |
|---------|-------------|
| `/machines` | List all connected machines |
| `/status` | Show relay statistics |
| `/quit` | Disconnect |
| (any text) | Send as chat message to all machines |

---

## API Endpoints (for programmatic access)

From the remote machine, you can also call the API directly:

```bash
# Register this machine
curl -X POST http://100.73.133.3:3000/api/relay/register \
  -H "X-Api-Token: pia-local-dev-token-2024" \
  -H "Content-Type: application/json" \
  -d '{"id":"dao-machine","name":"DAO Machine","project":"DAO","channels":["api"]}'

# Send a message
curl -X POST http://100.73.133.3:3000/api/relay/send \
  -H "X-Api-Token: pia-local-dev-token-2024" \
  -H "Content-Type: application/json" \
  -d '{"to":"hub-izzit7","content":"Hello from DAO!","type":"chat"}'

# Broadcast to all machines
curl -X POST http://100.73.133.3:3000/api/relay/broadcast \
  -H "X-Api-Token: pia-local-dev-token-2024" \
  -H "Content-Type: application/json" \
  -d '{"content":"Status update from DAO","type":"status"}'

# Get all messages
curl http://100.73.133.3:3000/api/relay/messages \
  -H "X-Api-Token: pia-local-dev-token-2024"

# List connected machines
curl http://100.73.133.3:3000/api/relay/machines \
  -H "X-Api-Token: pia-local-dev-token-2024"
```

---

## Troubleshooting

### Can't reach the hub?
1. Check Tailscale is connected: `tailscale status`
2. Check the hub is running: try the health endpoint
3. Check Windows Firewall on hub machine allows port 3000/3001
4. Try ngrok as an alternative

### WebSocket won't connect?
- Make sure port **3001** is also reachable (WebSocket port)
- Via Tailscale: `ws://100.73.133.3:3001`
- Use `--poll` flag for HTTP-only fallback

### Authentication errors?
- Token: `pia-local-dev-token-2024`
- Header: `X-Api-Token`

---

## Network Info

| Service | URL |
|---------|-----|
| PIA Hub API | http://100.73.133.3:3000 |
| PIA WebSocket | ws://100.73.133.3:3001 |
| Tailscale IP | 100.73.133.3 |
| Token | pia-local-dev-token-2024 |

---

*Generated by PIA | 2026-02-12*
